{"version":3,"sources":["webpack:///./src/views/AddCoupons.vue","webpack:///./src/views/AddCoupons.vue?a098"],"names":["id","class","for","$store","state","menuToggle","$route","meta","title","error","type","name","placeholder","formData","value","selected","sale_expire","expired_at","checked","amount","products_id","productsList","item","key","rows","description","addEditCoupon","showSpin","setup","DatePicker","created","this","arefApi","jmoment","components","TheSidemenu","TheTopmenu","data","params","couponId","methods","validateFrm","fn","format","Number","then","$swal","fire","text","icon","confirmButtonText","$router","push","catch","err","alertText","errors","i","finally","parseInt","getProductsList","getProductsIndex","res","loadCouponInfo","Promise","resolve","reject","getCoupon","resp","product","mounted","render"],"mappings":"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","file":"js/chunk-2d0dd849.d80c3ea1.js","sourcesContent":["<template>\n  <div class=\"d-flex\" :class=\"this.$store.state.menuToggle\" id=\"wrapper\">\n    <TheSidemenu />\n    <div id=\"page-content-wrapper\">\n      <TheTopmenu />\n      <div class=\"container-fluid text-start\">\n        <p class=\"fs-6 m-2\">\n          {{ this.$route.meta.title }}\n        </p>\n        <div v-if=\"error\" class=\"alert alert-danger\">\n          {{ error }}\n        </div>\n        <form class=\"row\">\n          <div class=\"col-md-4 col-xs-12\">\n            <div class=\"form-floating mb-3\">\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"name\"\n                name=\"name\"\n                placeholder=\"نام دسته\"\n                v-model=\"formData.name\"\n              />\n              <label for=\"name\">نام *</label>\n            </div>\n          </div>\n\n          <div class=\"col-md-4 col-xs-6\">\n            <div class=\"form-floating mb-3\">\n              <select\n                class=\"form-control\"\n                id=\"type\"\n                name=\"type\"\n                v-model=\"formData.type\"\n              >\n                <option value=\"amount\" :selected=\"formData.type == 'amount'\">\n                  ثابت - تومان\n                </option>\n                <option value=\"percent\" :selected=\"formData.type == 'percent'\">\n                  درصد\n                </option>\n              </select>\n              <label for=\"category_ones_id\">دسته سطح اول *</label>\n            </div>\n          </div>\n\n          <div class=\"col-md-4 col-xs-6\">\n            <label v-show=\"formData.sale_expire\" for=\"name\"> تاریخ انقضا</label>\n            <DatePicker\n              id=\"expired_at\"\n              name=\"expired_at\"\n              v-model=\"formData.expired_at\"\n              v-show=\"formData.expired_at\"\n            />\n            <br />\n            <input\n              type=\"checkbox\"\n              :checked=\"!formData.expired_at\"\n              @click=\"formData.expired_at = !formData.expired_at\"\n            />\n            بدون تاریخ انقضا\n          </div>\n\n          <div class=\"col-md-4 col-xs-12\">\n            <div class=\"form-floating mb-3\">\n              <input\n                type=\"text\"\n                class=\"form-control\"\n                id=\"amount\"\n                name=\"amount\"\n                placeholder=\"مقدار\"\n                v-model=\"formData.amount\"\n              />\n              <label for=\"amount\">مقدار *</label>\n            </div>\n          </div>\n\n          <div class=\"col-md-4 col-xs-12\">\n            <div class=\"form-floating mb-3\">\n              <select\n                class=\"form-control\"\n                id=\"products_id\"\n                name=\"products_id\"\n                v-model=\"formData.products_id\"\n              >\n                <option v-for=\"item in productsList\" :key=\"item.id\" :value=\"item.id\" >\n                  {{ item.name }}\n                </option>\n              </select>\n              <label for=\"products_id\">محصول *</label>\n            </div>\n          </div>\n          <div class=\"col-md-12 col-xs-12\">\n            <label for=\"description\">توضیحات</label>\n            <textarea\n              class=\"form-control\"\n              rows=\"3\"\n              id=\"description\"\n              name=\"description\"\n              v-model=\"formData.description\"\n            ></textarea>\n          </div>\n        </form>\n        <div class=\"mt-2\" >\n          <a class=\"btn btn-primary btn-block\" @click=\"addEditCoupon()\">\n            ثبت\n          </a>\n          <span v-show=\"showSpin\">\n            <i class=\"fas fa-spinner fa-spin mt-3\"></i>\n          </span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport TheSidemenu from \"../components/TheSidemenu\";\nimport TheTopmenu from \"../components/TheTopmenu\";\nimport ArefApi from \"../libs/api.js\";\nimport DatePicker from \"vue3-persian-datepicker\";\nimport \"vue3-persian-datepicker/dist/datepicker.min.css\";\nimport jmoment from \"moment-jalaali\";\n\nexport default {\n  name: \"AddCoupon\",\n  setup() {\n    return {\n      DatePicker,\n    };\n  },\n  created() {\n    this.arefApi = new ArefApi();\n    this.jmoment = jmoment;\n  },\n  components: {\n    TheSidemenu,\n    TheTopmenu,\n  },\n  data() {\n    return {\n      error: null,\n      showSpin: false,\n      productsList: null,\n      formData: {\n        id: this.$route.params.couponId ? this.$route.params.couponId : null,\n        name: null,\n        description: null,\n        amount: null,\n        type: null,\n        expired_at: null,\n        products_id: null,\n      },\n    };\n  },\n  methods: {\n    async addEditCoupon() {\n      if (!this.validateFrm()) {\n        return;\n      }\n      this.showSpin = true;\n\n      const fn = this.formData.id ? \"editCoupon\" : \"addCoupon\";\n      if (this.formData.expired_at) {\n        this.formData.expired_at = jmoment(\n          this.formData.expired_at,\n          \"jYYYY/jM/jD\"\n        ).format(\"YYYY-M-D\");\n      }\n      this.formData.products_id = Number(this.formData.products_id);\n      this.arefApi[fn](this.formData)\n        .then(() => {\n          this.$swal\n            .fire({\n              title: \"\",\n              text: `ثبت با موفقیت انجام شد`,\n              icon: \"success\",\n              confirmButtonText: \"متوجه شدم\",\n            })\n            .then(() => {\n              if (!this.formData.id) {\n                this.$router.push({ name: \"ListCoupons\" });\n              }\n            });\n        })\n        .catch((err) => {\n          let alertText = \"\";\n          if (err.data.errors) {\n            for (let i in err.data.errors) {\n              alertText += (alertText ? \"\" : \",\") + `${err.data.errors[i]} `;\n            }\n          }\n          this.$swal.fire({\n            title: \"!خطا\",\n            text: `${alertText}`,\n            icon: \"error\",\n            confirmButtonText: \"متوجه شدم\",\n          });\n        })\n        .finally(() => {\n          this.showSpin = false;\n        });\n    },\n    validateFrm: function () {\n      this.error = null;\n      if (!this.formData.name) {\n        this.error = \"نام باید بیشتر از دو حرف باشد\";\n        return false;\n      }\n\n      if (!this.formData.type) {\n        this.error = \"نوع را انتخاب کنید\";\n        return false;\n      }\n\n      if (!this.formData.amount) {\n        this.error = \"مقدار را انتخاب کنید\";\n        return false;\n      }\n\n      if (!this.formData.products_id) {\n        this.error = \"محصول را انتخاب کنید\";\n        return false;\n      }\n\n      if (this.formData.type == 'percent' && parseInt(this.formData.amount)>100) {\n        this.error = \"درصد تخفیف نمیتواند بیشتر از 100 باشد\";\n        return false;\n      }\n\n      return true;\n    },\n    async getProductsList() {\n      this.arefApi.getProductsIndex(1, true).then((res) => {\n        this.productsList = res.data;\n      });\n    },\n    async loadCouponInfo() {\n      return new Promise((resolve, reject) => {\n        this.arefApi\n          .getCoupon(this.formData.id)\n          .then((resp) => {\n            this.formData = resp.data;\n            this.formData.products_id = resp.data.product.id;\n            resolve();\n          })\n          .catch(() => {\n            this.$swal\n              .fire({\n                title: \"خطا!\",\n                text: \"کد تخفیف پیدا نشد \",\n                icon: \"error\",\n              })\n              .then(() => {\n                this.$router.push({ name: \"ListCoupons\" });\n              });\n            reject();  \n          });\n      });\n    },\n  },\n  async mounted() {\n    if (this.formData.id) {\n      await this.loadCouponInfo();\n    }\n    this.getProductsList();\n  },\n};\n</script>\n\n","import { render } from \"./AddCoupons.vue?vue&type=template&id=e165957a\"\nimport script from \"./AddCoupons.vue?vue&type=script&lang=js\"\nexport * from \"./AddCoupons.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}